import{a as Y,b as B,e as L,l as W}from"./chunk-D3LC5IFA.js";import{B as k,D as m,H as f,Ha as Q,I as U,La as $,M as x,P as _,Q as n,R as t,W as M,X as u,Z as b,_ as S,ba as i,ca as C,da as O,ea as E,fa as V,ga as z,la as N,na as j,p as g,q as p,ra as D,sa as T,ua as F,va as R,w as I,za as A}from"./chunk-7ZATYVOE.js";function J(s,r){if(s&1&&(n(0,"div",18)(1,"div",19)(2,"span",3),i(3,"error"),t(),i(4),t()()),s&2){let a=b();m(4),O(" ",a.errorMessage," ")}}function q(s,r){if(s&1){let a=M();n(0,"div",22)(1,"div",23)(2,"div",24)(3,"span",3),i(4,"person"),t()(),n(5,"div",25)(6,"h3"),i(7),t(),n(8,"div",26)(9,"span",3),i(10,"shield_person"),t(),i(11),t()()(),n(12,"button",27),u("click",function(){let o=g(a).$implicit,c=b(2);return p(c.onEditUser(o))}),n(13,"span",3),i(14,"edit"),t(),i(15," Edit "),t()()}if(s&2){let a=r.$implicit;m(7),C(a.name),m(4),O(" ",a.role," ")}}function G(s,r){if(s&1&&(n(0,"div",20),x(1,q,16,2,"div",21),t()),s&2){let a=b();m(),_("ngForOf",a.iamUsers())}}function K(s,r){s&1&&(n(0,"div",28)(1,"span",29),i(2,"group_off"),t(),n(3,"h2"),i(4,"No users found"),t(),n(5,"p"),i(6,"Try adjusting your search or add new IAM users to this domain."),t()())}var H=class s{constructor(r,a,e,o,c){this.http=r;this.router=a;this.loadingService=e;this.cd=o;this.platformId=c}rootUserId=null;domainId=null;domainName="";searchQuery="";iamUsers=I([]);errorMessage="";ngOnInit(){if(R(this.platformId)){let r=window.history.state;r&&r.domain_name?(this.domainId=r.domain_id,this.rootUserId=r.rootUser_id,this.domainName=r.domain_name,this.fetchIamUsers()):this.router.navigate(["/domain-explorer-v9z"])}}fetchIamUsers(){this.loadingService.show(),this.errorMessage="";let r=`http://localhost:8000/be/domain?domain_name=${encodeURIComponent(this.domainName)}`;this.searchQuery.trim()&&(r+=`&search=${encodeURIComponent(this.searchQuery.trim())}`);let a=e=>{try{let o=(e||"").toString().replace(/^"|"$/g,"").trim();if(!o){this.iamUsers.set([]);return}let c;try{c=JSON.parse(o)}catch{o.startsWith("[")&&o.endsWith("]")?c=o.slice(1,-1).split(/,(?![^()]*\))/).map(d=>d.trim().replace(/^"|"$/g,"")):c=[o]}if(Array.isArray(c)){let l=c.map(d=>{if(typeof d=="object"&&d!==null)return{id:d.id||0,name:d.name||"Unknown",role:d.role||"User",domain_name:d.domain_name||"",rootUser_id:d.rootUser_id||0};let h=d.toString(),P=h.match(/id\s*[=:]\s*(\d+)/i),v=h.match(/name\s*[=:]\s*([^,)\s]+)/i),y=h.match(/role\s*[=:]\s*([^,)\s]+)/i),w=h.match(/domain_name\s*[=:]\s*([^,)\s]+)/i);return{id:P?parseInt(P[1]):0,name:v?v[1].trim():"Unknown",role:y?y[1].trim():"User",domain_name:w?w[1].trim():"",rootUser_id:0}});this.iamUsers.set(l)}else this.iamUsers.set([])}catch(o){console.error("Final Parse Error:",o,e),this.errorMessage="Failed to process user data format."}this.cd.detectChanges()};this.http.get(r,{responseType:"text"}).subscribe({next:e=>{this.loadingService.hide(),a(e)},error:e=>{if(this.loadingService.hide(),e.status===302&&e.error){a(e.error);return}console.error("Error fetching IAM users:",e),this.errorMessage="Failed to load IAM users. Please try again.",this.cd.detectChanges()}})}onSearch(){this.fetchIamUsers()}onEditUser(r){this.router.navigate(["/edit-iam-c4k"],{state:{user:r,domain_id:this.domainId,rootUser_id:this.rootUserId,domain_name:this.domainName}})}goBack(){this.router.navigate(["/view-domain-k2m"],{state:{domain_id:this.domainId,rootUser_id:this.rootUserId,domain_name:this.domainName}})}static \u0275fac=function(a){return new(a||s)(f(A),f(Q),f($),f(j),f(k))};static \u0275cmp=U({type:s,selectors:[["app-view-iam-users"]],decls:27,vars:6,consts:[["emptyState",""],[1,"view-iam-wrapper"],[1,"back-link",3,"click"],[1,"material-symbols-rounded"],[1,"main-content"],[1,"page-header"],[1,"header-content"],[1,"title-section"],[1,"subtitle"],[1,"domain-name"],[1,"search-section"],[1,"search-box"],[1,"material-symbols-rounded","search-icon"],["type","text","placeholder","Search by name...",3,"ngModelChange","keyup.enter","ngModel"],[1,"search-btn",3,"click","disabled"],[1,"users-container"],["class","status-messages",4,"ngIf"],["class","users-grid",4,"ngIf","ngIfElse"],[1,"status-messages"],[1,"message","error"],[1,"users-grid"],["class","user-card",4,"ngFor","ngForOf"],[1,"user-card"],[1,"user-info"],[1,"avatar-box"],[1,"text-info"],[1,"role-badge"],[1,"edit-btn",3,"click"],[1,"empty-state"],[1,"material-symbols-rounded","empty-icon"]],template:function(a,e){if(a&1){let o=M();n(0,"div",1)(1,"button",2),u("click",function(){return g(o),p(e.goBack())}),n(2,"span",3),i(3,"arrow_back"),t(),i(4," Back "),t(),n(5,"div",4)(6,"header",5)(7,"div",6)(8,"div",7)(9,"h1"),i(10,"IAM Users"),t(),n(11,"p",8),i(12,"Managing access for "),n(13,"span",9),i(14),t()()(),n(15,"div",10)(16,"div",11)(17,"span",12),i(18,"search"),t(),n(19,"input",13),z("ngModelChange",function(l){return g(o),V(e.searchQuery,l)||(e.searchQuery=l),p(l)}),u("keyup.enter",function(){return g(o),p(e.onSearch())}),t()(),n(20,"button",14),u("click",function(){return g(o),p(e.onSearch())}),i(21," Search "),t()()()(),n(22,"div",15),x(23,J,5,1,"div",16)(24,G,2,1,"div",17)(25,K,7,0,"ng-template",null,0,N),t()()()}if(a&2){let o=S(26);m(14),C(e.domainName),m(5),E("ngModel",e.searchQuery),m(),_("disabled",!e.searchQuery.trim()),m(3),_("ngIf",e.errorMessage),m(),_("ngIf",e.iamUsers().length>0)("ngIfElse",o)}},dependencies:[F,D,T,W,Y,B,L],styles:["[_nghost-%COMP%]{display:block;min-height:100vh;background-color:#000;font-family:Inter,sans-serif;color:#fff}.view-iam-wrapper[_ngcontent-%COMP%]{padding:2rem;position:relative;max-width:1200px;margin:0 auto;min-height:100vh;box-sizing:border-box}.back-link[_ngcontent-%COMP%]{position:fixed;top:2rem;left:2rem;background:transparent;border:none;color:#aaa;display:flex;align-items:center;gap:.5rem;cursor:pointer;font-size:.9rem;padding:0;transition:all .2s;z-index:100}.back-link[_ngcontent-%COMP%]:hover{color:#fff;transform:translate(-4px)}.back-link[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:20px}@media(max-width:1300px){.back-link[_ngcontent-%COMP%]{position:absolute}}.main-content[_ngcontent-%COMP%]{padding-top:4rem}.page-header[_ngcontent-%COMP%]{margin-bottom:3rem;animation:_ngcontent-%COMP%_fadeInDown .8s cubic-bezier(.16,1,.3,1)}.page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-end;gap:2rem}@media(max-width:900px){.page-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2.8rem;font-weight:800;margin-bottom:.5rem;letter-spacing:-.03em;background:linear-gradient(to bottom,#fff,#888);background-clip:text;-webkit-background-clip:text;-webkit-text-fill-color:transparent}.page-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{color:#aaa;font-size:1.1rem}.page-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]   .domain-name[_ngcontent-%COMP%]{color:#fff;font-weight:600}.search-section[_ngcontent-%COMP%]{display:flex;gap:1rem;width:100%;max-width:450px}.search-section[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]{position:relative;flex:1;display:flex;align-items:center}.search-section[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]   .search-icon[_ngcontent-%COMP%]{position:absolute;left:14px;color:#555;font-size:20px}.search-section[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;background:#0a0a0a;border:1px solid #1a1a1a;border-radius:12px;padding:12px 14px 12px 44px;color:#fff;font-family:inherit;font-size:.95rem;outline:none;transition:all .3s}.search-section[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#fff3;background:#111;box-shadow:0 0 0 4px #ffffff08}.search-section[_ngcontent-%COMP%]   .search-btn[_ngcontent-%COMP%]{background:#fff;color:#000;border:none;padding:0 1.5rem;border-radius:12px;font-weight:700;font-size:.9rem;cursor:pointer;transition:all .3s cubic-bezier(.16,1,.3,1)}.search-section[_ngcontent-%COMP%]   .search-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 15px #ffffff1a}.search-section[_ngcontent-%COMP%]   .search-btn[_ngcontent-%COMP%]:active:not(:disabled){transform:translateY(0)}.search-section[_ngcontent-%COMP%]   .search-btn[_ngcontent-%COMP%]:disabled{background:#222;color:#555;cursor:not-allowed;opacity:.6;filter:grayscale(1)}.users-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:1.5rem;animation:_ngcontent-%COMP%_fadeInUp .8s cubic-bezier(.16,1,.3,1)}@media(max-width:450px){.users-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.user-card[_ngcontent-%COMP%]{background:#141414b3;-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.08);border-radius:20px;padding:1.5rem;display:flex;justify-content:space-between;align-items:center;transition:all .3s}.user-card[_ngcontent-%COMP%]:hover{border-color:#fff3;background:#1e1e1ecc;transform:translateY(-4px)}.user-card[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1.2rem}.user-card[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .avatar-box[_ngcontent-%COMP%]{width:52px;height:52px;background:#ffffff0d;border-radius:14px;display:flex;align-items:center;justify-content:center;color:#777}.user-card[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .avatar-box[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:28px}.user-card[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .text-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600;margin-bottom:.3rem}.user-card[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .text-info[_ngcontent-%COMP%]   .role-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;font-size:.8rem;color:#aaa;background:#ffffff08;padding:4px 10px;border-radius:6px;font-weight:500}.user-card[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .text-info[_ngcontent-%COMP%]   .role-badge[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:16px}.user-card[_ngcontent-%COMP%]   .edit-btn[_ngcontent-%COMP%]{background:#ffffff0d;border:1px solid rgba(255,255,255,.1);color:#fff;padding:8px 16px;border-radius:10px;font-size:.85rem;font-weight:600;display:flex;align-items:center;gap:6px;cursor:pointer;transition:all .2s}.user-card[_ngcontent-%COMP%]   .edit-btn[_ngcontent-%COMP%]:hover{background:#fff;color:#000;border-color:#fff}.user-card[_ngcontent-%COMP%]   .edit-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:18px}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:5rem 2rem}.empty-state[_ngcontent-%COMP%]   .empty-icon[_ngcontent-%COMP%]{font-size:80px;color:#222;margin-bottom:1.5rem}.empty-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.8rem;margin-bottom:.5rem}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#aaa}.status-messages[_ngcontent-%COMP%]{margin-bottom:2rem}.status-messages[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.8rem;padding:1rem;border-radius:12px;justify-content:center}.status-messages[_ngcontent-%COMP%]   .message.error[_ngcontent-%COMP%]{color:#ff5252;background:#ff52521a}@keyframes _ngcontent-%COMP%_fadeInDown{0%{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_fadeInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}"]})};export{H as ViewIamUsers};
